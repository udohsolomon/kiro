<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KIRO LABYRINTH // MAZE CHALLENGE</title>
    <link rel="stylesheet" href="css/cyberpunk.css?v=7">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <!-- Screen Overlays -->
    <div class="grid-overlay"></div>
    <div class="scanlines"></div>
    <div class="vignette"></div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="flex items-center justify-center" style="position: fixed; inset: 0; z-index: 2000; background: var(--bg-dark);">
        <div class="cyber-loading">INITIALIZING LABYRINTH SYSTEM...</div>
    </div>

    <!-- HUD - Top Left: System Status -->
    <div class="hud hud-tl">
        <div class="data-label">SYSTEM</div>
        <div class="data-value text-green" id="system-status">ONLINE</div>
        <div class="data-label mt-2">SESSION</div>
        <div class="data-value" id="session-id">--</div>
    </div>

    <!-- HUD - Top Right: Turn Counter (hidden on dashboard) -->
    <div class="hud hud-tr" id="hud-tr">
        <div class="data-label">TURNS</div>
        <div class="data-value" id="turn-count" style="font-size: 36px;">0</div>
    </div>

    <!-- HUD - Bottom Left: Position -->
    <div class="hud hud-bl">
        <div class="data-label">POSITION</div>
        <div class="data-value" id="player-pos">0, 0</div>
        <div class="data-label mt-2">STATUS</div>
        <div class="data-value" id="player-status">READY</div>
    </div>

    <!-- HUD - Bottom Right: Maze Info -->
    <div class="hud hud-br">
        <div class="data-label">MAZE</div>
        <div class="data-value" id="maze-name">TUTORIAL</div>
        <div class="data-label mt-2">SIZE</div>
        <div class="data-value" id="maze-size">10x10</div>
    </div>

    <!-- Main Content -->
    <main id="main-content" style="display: none; position: relative; z-index: 10; min-height: 100vh; padding: 100px 40px;">

        <!-- Welcome Screen -->
        <section id="welcome-screen" class="flex flex-col items-center justify-center" style="min-height: calc(100vh - 200px);">
            <h1 class="cyber-title mb-2">KIRO LABYRINTH</h1>
            <p class="cyber-subtitle mb-3">ESCAPE THE MAZE WITH MINIMAL TURNS</p>

            <div class="flex gap-2 mt-3">
                <button class="cyber-btn cyber-btn-primary" onclick="showScreen('register-screen')">
                    REGISTER
                </button>
                <button class="cyber-btn" onclick="showScreen('login-screen')">
                    LOGIN
                </button>
            </div>

            <!-- Google Sign-In (initialized dynamically) -->
            <div class="mt-3" id="google-signin-container">
                <!-- Google Sign-In button will be rendered here by JavaScript -->
            </div>

            <div class="mt-3" style="max-width: 600px; text-align: center;">
                <p class="cyber-subtitle" style="font-size: 12px; line-height: 1.8;">
                    Navigate through the labyrinth using your custom solver.<br>
                    Every MOVE counts as a turn. LOOK is FREE.<br>
                    Beware of MUD - it will trap you for one turn.
                </p>
            </div>
        </section>

        <!-- Registration Screen -->
        <section id="register-screen" class="flex flex-col items-center justify-center" style="min-height: calc(100vh - 200px); display: none;">
            <div class="cyber-panel" style="width: 100%; max-width: 400px;">
                <h2 class="cyber-title mb-3" style="font-size: 1.5rem;">REGISTER</h2>

                <form id="register-form" onsubmit="handleRegister(event)">
                    <div class="mb-2">
                        <label class="data-label">USERNAME</label>
                        <input type="text" class="cyber-input" id="reg-username" placeholder="Enter callsign..." required>
                    </div>

                    <div class="mb-2">
                        <label class="data-label">EMAIL</label>
                        <input type="email" class="cyber-input" id="reg-email" placeholder="Enter email..." required>
                    </div>

                    <div class="mb-3">
                        <label class="data-label">PASSWORD</label>
                        <input type="password" class="cyber-input" id="reg-password" placeholder="Enter password..." required>
                    </div>

                    <button type="submit" class="cyber-btn cyber-btn-primary" style="width: 100%;">
                        INITIALIZE ACCOUNT
                    </button>
                </form>

                <p class="mt-2" style="text-align: center;">
                    <span class="cyber-subtitle" style="font-size: 11px;">Already registered? </span>
                    <a href="#" onclick="showScreen('login-screen')" class="text-cyan" style="font-size: 11px;">LOGIN</a>
                </p>
            </div>
        </section>

        <!-- Login Screen -->
        <section id="login-screen" class="flex flex-col items-center justify-center" style="min-height: calc(100vh - 200px); display: none;">
            <div class="cyber-panel" style="width: 100%; max-width: 400px;">
                <h2 class="cyber-title mb-3" style="font-size: 1.5rem;">LOGIN</h2>

                <form id="login-form" onsubmit="handleLogin(event)">
                    <div class="mb-2">
                        <label class="data-label">EMAIL</label>
                        <input type="email" class="cyber-input" id="login-email" placeholder="Enter email..." required>
                    </div>

                    <div class="mb-3">
                        <label class="data-label">PASSWORD</label>
                        <input type="password" class="cyber-input" id="login-password" placeholder="Enter password..." required>
                    </div>

                    <button type="submit" class="cyber-btn cyber-btn-primary" style="width: 100%;">
                        AUTHENTICATE
                    </button>
                </form>

                <p class="mt-2" style="text-align: center;">
                    <span class="cyber-subtitle" style="font-size: 11px;">New user? </span>
                    <a href="#" onclick="showScreen('register-screen')" class="text-cyan" style="font-size: 11px;">REGISTER</a>
                </p>
            </div>
        </section>

        <!-- Dashboard Screen -->
        <section id="dashboard-screen" class="flex gap-3" style="display: none;">
            <!-- Left Panel: Controls & Info -->
            <div style="flex: 0 0 300px;">
                <div class="cyber-panel mb-2">
                    <h3 class="data-label mb-2">CHALLENGE SELECT</h3>
                    <select class="cyber-input" id="maze-select" onchange="selectMaze(this.value)">
                        <option value="tutorial">TUTORIAL (15x13)</option>
                        <option value="intermediate">INTERMEDIATE (31x17)</option>
                        <option value="challenge">CHALLENGE (100x49)</option>
                    </select>

                    <button class="cyber-btn cyber-btn-primary mt-2" style="width: 100%;" onclick="startSession()">
                        START SESSION
                    </button>
                </div>

                <div class="cyber-panel mb-2">
                    <h3 class="data-label mb-2">CONTROLS</h3>
                    <div class="flex flex-col gap-1">
                        <div class="flex gap-1 justify-center">
                            <button class="cyber-btn" onclick="move('north')" style="padding: 8px 16px;">N</button>
                        </div>
                        <div class="flex gap-1 justify-center">
                            <button class="cyber-btn" onclick="move('west')" style="padding: 8px 16px;">W</button>
                            <button class="cyber-btn cyber-btn-pink" onclick="look()" style="padding: 8px 12px;">LOOK</button>
                            <button class="cyber-btn" onclick="move('east')" style="padding: 8px 16px;">E</button>
                        </div>
                        <div class="flex gap-1 justify-center">
                            <button class="cyber-btn" onclick="move('south')" style="padding: 8px 16px;">S</button>
                        </div>
                    </div>
                    <p class="cyber-subtitle mt-2" style="font-size: 10px; text-align: center;">
                        MOVE = 1 TURN | LOOK = FREE
                    </p>
                </div>

                <div class="cyber-panel">
                    <h3 class="data-label mb-2">DOWNLOAD STARTER</h3>
                    <button class="cyber-btn" style="width: 100%;" onclick="downloadStarter()">
                        GET PACKAGE
                    </button>
                    <p class="cyber-subtitle mt-1" style="font-size: 10px;">
                        Includes Python SDK & examples
                    </p>
                </div>
            </div>

            <!-- Center: Maze Visualization -->
            <div class="flex-1 flex items-center justify-center">
                <div class="maze-container" id="maze-container">
                    <div id="maze-grid" class="maze-grid">
                        <!-- Maze cells rendered by JS -->
                    </div>
                </div>
            </div>

            <!-- Right Panel: Stats & Leaderboard -->
            <div class="right-panel">
                <!-- Player Stats -->
                <div class="cyber-panel stats-panel mb-2">
                    <div class="stats-row">
                        <div class="stat-box">
                            <div class="data-label">TURNS</div>
                            <div class="data-value text-cyan" id="stats-turns">0</div>
                        </div>
                        <div class="stat-box">
                            <div class="data-label">BEST</div>
                            <div class="data-value text-gold" id="stats-best">--</div>
                        </div>
                    </div>
                    <button class="cyber-btn cyber-btn-primary profile-btn-inline" id="profile-btn" onclick="toggleProfilePanel()" style="display: none;">
                        PROFILE
                    </button>
                </div>

                <!-- Leaderboard -->
                <div class="cyber-panel leaderboard">
                    <div class="leaderboard-header">
                        <span class="leaderboard-icon">&#9733;</span>
                        <span class="leaderboard-title">LEADERBOARD</span>
                    </div>
                    <ul class="leaderboard-list" id="leaderboard-list">
                        <!-- Populated by JS -->
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <!-- Celebration Modal -->
    <div id="celebration-modal" class="celebration-modal" style="display: none;">
        <div class="celebration-content cyber-panel">
            <div class="celebration-icon">&#127881;</div>
            <h2 class="cyber-title celebration-title">MAZE ESCAPED!</h2>

            <div class="celebration-stats">
                <div class="stat-item">
                    <span class="data-label">TOTAL TURNS</span>
                    <span class="data-value text-cyan" id="celebration-turns">0</span>
                </div>
                <div class="stat-item">
                    <span class="data-label">MAZE</span>
                    <span class="data-value text-green" id="celebration-maze">TUTORIAL</span>
                </div>
            </div>

            <div class="celebration-message" id="celebration-message">
                Congratulations, Navigator!
            </div>

            <div class="celebration-actions">
                <button class="cyber-btn cyber-btn-primary" onclick="playAgain()">
                    PLAY AGAIN
                </button>
                <button class="cyber-btn" onclick="closeCelebration()">
                    CLOSE
                </button>
            </div>
        </div>
    </div>

    <!-- Profile Panel -->
    <div id="profile-overlay" class="profile-overlay" onclick="toggleProfilePanel()" style="display: none;"></div>
    <div id="profile-panel" class="cyber-panel profile-panel" style="display: none;">
        <div class="profile-header">
            <span class="data-label">USER PROFILE</span>
            <button class="cyber-btn cyber-btn-small" onclick="toggleProfilePanel()">X</button>
        </div>
        <div class="profile-content">
            <div class="profile-field">
                <span class="data-label">USERNAME</span>
                <span class="data-value" id="profile-username">--</span>
            </div>
            <div class="profile-field">
                <span class="data-label">EMAIL</span>
                <span class="data-value profile-email" id="profile-email">--</span>
            </div>
            <div class="profile-field">
                <span class="data-label">API KEY</span>
                <div class="api-key-display">
                    <span class="data-value api-key-text" id="profile-api-key">--</span>
                    <button class="cyber-btn cyber-btn-small" onclick="copyApiKey()">COPY</button>
                </div>
                <p class="api-key-hint">Use with: export KIRO_API_KEY=your_key</p>
            </div>
            <div class="profile-actions">
                <button class="cyber-btn cyber-btn-pink" onclick="regenerateApiKey()">REGENERATE KEY</button>
                <button class="cyber-btn" onclick="logout()">LOGOUT</button>
            </div>
        </div>
    </div>

    <!-- API Key Modal (shown after regeneration) -->
    <div id="api-key-modal-overlay" class="profile-overlay" style="display: none; z-index: 2999;"></div>
    <div id="api-key-modal" class="cyber-panel api-key-modal" style="display: none;">
        <h3 class="cyber-title" style="font-size: 1.2rem; margin-bottom: 16px; color: var(--cyber-green);">
            NEW API KEY GENERATED
        </h3>
        <p class="data-label">Your new API key (save it now!):</p>
        <div class="api-key-full" id="api-key-full-display">--</div>
        <p class="api-key-warning">
            WARNING: This key will not be shown again!<br>
            Save it securely before closing this window.
        </p>
        <div class="flex gap-2 justify-center">
            <button class="cyber-btn cyber-btn-primary" onclick="copyNewApiKey()">COPY KEY</button>
            <button class="cyber-btn" onclick="closeApiKeyModal()">I'VE SAVED IT</button>
        </div>
    </div>

    <!-- Status Log -->
    <div class="status-log" id="status-log">
        <div class="status-log-line">SYSTEM BOOT COMPLETE</div>
    </div>

    <!-- Runtime config injection (replaced by build script for Railway) -->
    <script>
        // This will be replaced with actual API URL during deployment
        // window.KIRO_API_URL = 'https://your-api.railway.app';
    </script>
    <script src="js/app.js?v=11"></script>
</body>
</html>
